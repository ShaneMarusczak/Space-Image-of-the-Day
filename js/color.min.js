function ColorFinder(k){this.callback=k;this.getMostProminentColor=function(a){var c=null;this.callback||(this.callback=function(){return 1});a=this.getImageData(a);c=this.getMostProminentRGBImpl(a,6,c,this.callback);c=this.getMostProminentRGBImpl(a,4,c,this.callback);c=this.getMostProminentRGBImpl(a,2,c,this.callback);return c=this.getMostProminentRGBImpl(a,0,c,this.callback)};this.getImageData=function(a,c,e,d){var f=document.createElement("canvas");d=f.getContext&&f.getContext("2d");var b,h;e=
-4;if(!d)return defaultRGB;h=f.height=a.naturalHeight||a.offsetHeight||a.height;f=f.width=a.naturalWidth||a.offsetWidth||a.width;d.drawImage(a,0,0);try{b=d.getImageData(0,0,f,h)}catch(l){return null}h=b.data.length;for(var f=Math.max(1,Math.round(h/5E3)),g={};(e+=4*f)<h;)32<b.data[e+3]&&(d=(b.data[e]>>c)+","+(b.data[e+1]>>c)+","+(b.data[e+2]>>c),g.hasOwnProperty(d)?(a=g[d],a.count++):(a={r:b.data[e],g:b.data[e+1],b:b.data[e+2],count:1},a.weight=this.callback(a.r,a.g,a.b),0>=a.weight&&(a.weight=1E-10),
g[d]=a));return g};this.getMostProminentRGBImpl=function(a,c,e,d){d={r:0,g:0,b:0,count:0,d:c};var f={},b,h,g=0;for(h in a)b=a[h],totalWeight=b.weight*b.count,++g,this.doesRgbMatch(e,b.r,b.g,b.b)&&(b=(b.r>>c)+","+(b.g>>c)+","+(b.b>>c),f.hasOwnProperty(b)?f[b]+=totalWeight:f[b]=totalWeight);for(i in f)data=i.split(","),a=data[0],c=data[1],e=data[2],g=f[i],g>d.count&&(d.count=g,data=i.split(","),d.r=a,d.g=c,d.b=e);return d};this.doesRgbMatch=function(a,c,e,d){if(null==a)return!0;c>>=a.d;e>>=a.d;d>>=
a.d;return a.r==c&&a.g==e&&a.b==d}};
